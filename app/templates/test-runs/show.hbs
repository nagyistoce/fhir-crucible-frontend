<div class="container main">
  <div class="row content">
    <div class="col-md-12">
      <div class="palette report">
        <div class="row">
          <div class="col-md-10">
            <h2>Review Test Results</h2>
          </div>
          <div class="col-md-2">
            <button class="btn orange_btn" {{action "rerun"}}>Rerun</button>
          </div>
        </div>
        <p class="helper_text">Each of the run tests provide details on the results of the test along with information about how the test relates to the specification and the server's conformance document. </p>
        {{#if runningTestCount}}
          <div class="row">
            <div class="progress">
              <div {{bind-attr class=":progress-bar :progress-bar-striped :active"}} role="progressbar" {{bind-attr aria-valuenow=executionProgress}} aria-valuemin="0" aria-valuemax="100" {{bind-attr style=progressStyle}}>
                <span class="sr-only">{{executionProgress}}% Complete</span>
              </div>
            </div>
          </div>
        {{/if}}

        <div class="row">
          <ul class="nav nav-tabs tabbed-data-container">
            <li class="tabbed-data active"><a data-toggle="tab" href="#test-data">Tests</a></li>
            <li class="tabbed-data"><a data-toggle="tab"href="#conformance-data">Conformance</a></li>
            <li class="tabbed-data"><a data-toggle="tab"href="#heatmap-data">Heat Map</a></li>
          </ul>
        </div>
        <div class="row">
          <div class="tab-content">
            <!-- TEST PANEL START -->
            <div class="tab-pane active test-results" id="test-data">
              <div class="col-md-12 tab-content-holder">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                  {{#each testResults as |result|}}
                      <div class="toggleable panel-heading">
                        <h4 class="panel-title">
                          <label >
                            {{result.test.name}}
                          </label>
                          <a class="collapsed" data-toggle="collapse" {{bind-attr data-target="result.selector"}} aria-expanded="false" >
                          <small>(more)</small></a>
                          {{#if test.hasResults}}
                            <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate tests"></span>
                          {{/if}}

                            <i {{bind-attr class=":glyphicon  result.passed:glyphicon-ok-circle:glyphicon-remove-circle result.passed:passed:failed"}}></i>

                        </h4>
                      </div>
                      <div {{bind-attr id="result.data_selector"}} class="panel-collapse collapse">
                        {{result.test.description}}<br>
                      <div class="row">
                        <div class="col-md-7">
                          <table class="table table-hover report-table nav nav-stacked">
                            <tbody>
                              {{#each result.results as |test|}}
                                  <tr data-toggle="pill" {{bind-attr data-target="test.selector"}}>
                                    <td>
                                      {{test.id}}
                                    </td>
                                    <td>
                                      {{test.description}}
                                    </td>
                                    <td>
                                      <span {{bind-attr class="test.status"}}>{{test.status}}</span>
                                    </td>
                                    <td>
                                      {{#if test.warnings}}<i class="glyphicon glyphicon-warning-sign warning"></i>{{/if}}
                                    </td>
                                  </tr>
                              {{/each}}

                            </tbody>
                          </table>
                        </div>
                        <div class="col-md-5 tab-content details">
                          {{#each result.results as |test|}}
                            <div class="tab-pane" {{bind-attr id="test.data_selector"}}>
                              <div class="media">
                                {{#if test.message}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Message</h4>
                                      {{test.message}}
                                    </div>
                                  </div>
                                {{/if}}
                                {{#if test.warnings}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Warnings</h4>
                                      {{#each test.warnings as |warning|}}
                                        <div>{{warning}}</div>
                                      {{/each}}
                                    </div>
                                  </div>
                                {{/if}}
                                {{#if test.links}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Links</h4>
                                      {{#each test.links as |link|}}
                                        <div><a {{bind-attr href="link"}} target="_blank">Related FHIR Spec Location</a></div>
                                      {{/each}}
                                    </div>
                                  </div>
                                {{/if}}
                                {{#if test.requires}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Test Requires</h4>
                                        {{#each test.requires as |requirement|}}
                                          <div>{{#if requirement.resource}}{{requirement.resource}}{{else}}System{{/if}}: {{requirement.methods}}</div>
                                        {{/each}}
                                    </div>
                                  </div>
                                {{/if}}
                                {{#if test.validates}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Test Validates</h4>
                                        {{#each test.validates as |requirement|}}
                                          <div>{{#if requirement.resource}}{{requirement.resource}}{{else}}System{{/if}}: {{requirement.methods}}</div>
                                        {{/each}}
                                    </div>
                                  </div>
                                {{/if}}
                                {{#if test.data}}
                                  <div class="media">
                                    <div class="media-body">
                                      <h4 class="media-heading">Data</h4>
                                      {{test.data}}
                                    </div>
                                  </div>
                                {{/if}}
                              </div>
                            </div>
                          {{/each}}
                        </div>
                      </div>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
            <!-- TEST PANEL END -->
            <!-- CONFORMANCE PANEL START -->
            <div class="tab-pane" id="conformance-data">
              {{debugger}}
              {{view 'conformance' contextBinding="conformance"}}
            </div>
            <!-- CONFORMANCE PANEL END -->
            <!-- HEATMAP PANEL START -->
            <div class="tab-pane" id="heatmap-data">
              <div class="col-md-12 tab-content-holder">heat</div>
            </div>
            <!-- HEATMAP PANEL END -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
